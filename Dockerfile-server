FROM node:14

# Установка необходимых пакетов
RUN apt-get update && \
    apt-get install -y curl && \
    apt-get install -y software-properties-common && \
    apt-get clean

# Установка последней версии Git
RUN curl -fsSL https://deb.nodesource.com/setup_14.x | bash - && \
    curl -s https://packagecloud.io/install/repositories/github/git-lfs/script.deb.sh | bash && \
    apt-get install -y git && \
    apt-get clean

# Установка рабочей директории
WORKDIR /usr/src/server

# Клонирование репозитория
RUN git clone --no-checkout https://github.com/Sashmolod/vizitka.git .

# Инициализация sparse-checkout и выбор нужной папки
RUN git sparse-checkout init --cone && \
    git sparse-checkout set server && \
    git checkout master

# Установка зависимостей
COPY package*.json ./
RUN npm install

EXPOSE 3050

CMD ["node", "server.js"]
